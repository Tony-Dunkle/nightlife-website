<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nightlife RP | Staff Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="h-full">
    <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8 bg-gray-900">
        <div class="sm:mx-auto sm:w-full sm:max-w-sm">
            <!-- Logo and Title -->
            <svg class="mx-auto h-12 w-auto text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
            </svg>
            <h2 class="mt-6 text-center text-2xl font-bold leading-9 tracking-tight text-white">Nightlife RP</h2>
            <p class="mt-2 text-center text-sm text-gray-400">Staff Portal Login</p>
        </div>

        <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
            <form id="loginForm" class="space-y-6">
                <!-- Email/Username Input -->
                <div>
                    <label for="email" class="block text-sm font-medium leading-6 text-white">Email Address</label>
                    <div class="mt-2">
                        <input id="email" name="email" type="email" autocomplete="email" required class="block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6">
                    </div>
                </div>

                <!-- Password Input -->
                <div>
                    <div class="flex items-center justify-between">
                        <label for="password" class="block text-sm font-medium leading-6 text-white">Password</label>
                    </div>
                    <div class="mt-2">
                        <input id="password" name="password" type="password" autocomplete="current-password" required class="block w-full rounded-md border-0 bg-white/5 py-2 px-3 text-white shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6">
                    </div>
                </div>

                <!-- Error Message Display -->
                <div id="error-message" class="text-red-400 text-sm hidden"></div>

                <!-- Login Button -->
                <div>
                    <button type="submit" class="flex w-full justify-center rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">
                        <span id="button-text">Sign in</span>
                        <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        // --- Firebase Imports ---
        // These import the necessary functions from the Firebase SDK.
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration ---
        // This configuration object connects your website to YOUR Firebase project.
        const firebaseConfig = {
            apiKey: "AIzaSyDC3X0D6daim4gKQhBp4S2hoBK8w4EgWRg",
            authDomain: "nightlife-staff.firebaseapp.com",
            projectId: "nightlife-staff",
            storageBucket: "nightlife-staff.appspot.com",
            messagingSenderId: "1092255472588",
            appId: "1:1092255472588:web:0ca2211fa49a56b9d19b69",
            measurementId: "G-CTW517R83R"
        };

        // --- Initialize Firebase ---
        // This sets up the connection to Firebase services.
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM Element References ---
        // Gets references to the HTML elements we need to interact with.
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const errorMessageDiv = document.getElementById('error-message');
        const submitButton = loginForm.querySelector('button[type="submit"]');
        const buttonText = document.getElementById('button-text');
        const loadingSpinner = document.getElementById('loading-spinner');

        // --- Authentication State Observer ---
        // This function runs whenever the user's login state changes.
        onAuthStateChanged(auth, user => {
            if (user) {
                // If the user is logged in, redirect them to the staff dashboard.
                // You will need to create this 'dashboard.html' page.
                console.log("User is signed in, redirecting...");
                window.location.href = 'dashboard.html';
            } else {
                // User is signed out.
                console.log("User is signed out.");
            }
        });

        // --- Login Form Submission Handler ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevents the default form submission (page reload).

            // Show loading state
            setLoading(true);
            errorMessageDiv.classList.add('hidden'); // Hide previous errors

            const email = emailInput.value;
            const password = passwordInput.value;

            try {
                // Use Firebase to sign the user in with their email and password.
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log('Successfully signed in as:', user.email);
                // The onAuthStateChanged observer will handle the redirect.
            } catch (error) {
                // If login fails, display an error message.
                console.error('Login Error:', error.code, error.message);
                showError(getFriendlyErrorMessage(error.code));
                setLoading(false);
            }
        });

        // --- UI Helper Functions ---

        function setLoading(isLoading) {
            if (isLoading) {
                submitButton.disabled = true;
                buttonText.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
            } else {
                submitButton.disabled = false;
                buttonText.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
            }
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
        }

        function getFriendlyErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/invalid-email':
                    return 'Please enter a valid email address.';
                case 'auth/user-not-found':
                case 'auth/wrong-password':
                case 'auth/invalid-credential':
                    return 'Invalid email or password. Please try again.';
                case 'auth/too-many-requests':
                    return 'Access to this account has been temporarily disabled due to many failed login attempts. You can immediately restore it by resetting your password or you can try again later.';
                default:
                    return 'An unexpected error occurred. Please try again.';
            }
        }
    </script>
</body>
</html>