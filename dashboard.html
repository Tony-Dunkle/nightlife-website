<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nightlife Staff - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1f2937;
        }

        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: #4338ca;
            }

        /* --- NEW TAB STYLES --- */
        .tab-btn {
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            color: #9ca3af; /* gray-400 */
            border-bottom: 2px solid transparent;
        }

            .tab-btn:hover {
                background-color: #374151; /* gray-700 */
                color: #e5e7eb; /* gray-200 */
            }

            .tab-btn.active {
                color: white;
                border-bottom-color: #4f46e5; /* indigo-600 */
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
            }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Main Container -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <nav class="w-64 bg-gray-800 p-5 flex flex-col justify-between">
            <div>
                <h1 class="text-2xl font-bold text-indigo-400 mb-10">Nightlife Staff</h1>
                <ul>
                    <li class="mb-4">
                        <a href="dashboard.html" class="flex items-center p-2 text-base font-normal text-white rounded-lg bg-gray-700">
                            <i data-lucide="home" class="w-6 h-6"></i>
                            <span class="ml-3">Dashboard</span>
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="admin.html" class="flex items-center p-2 text-base font-normal text-white rounded-lg hover:bg-gray-700">
                            <i data-lucide="layout-dashboard" class="w-6 h-6"></i>
                            <span class="ml-3">Admin</span>
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="roster.html" class="flex items-center p-2 text-base font-normal text-white rounded-lg hover:bg-gray-700">
                            <i data-lucide="shield" class="w-6 h-6"></i>
                            <span class="ml-3">Staff Roster</span>
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="playermanagement.html" class="flex items-center p-2 text-base font-normal text-white rounded-lg hover:bg-gray-700">
                            <i data-lucide="notebook-pen" class="w-6 h-6"></i>
                            <span class="ml-3">Player Management</span>
                        </a>
                    </li>
                    <li class="mb-4">
                        <a href="AI.html" class="flex items-center p-2 text-base font-normal text-white rounded-lg hover:bg-gray-700">
                            <i data-lucide="brain-circuit" class="w-6 h-6"></i>
                            <span class="ml-3">AI Analysis</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div>
                <button id="logout-btn" class="w-full flex items-center p-2 text-base font-normal text-white rounded-lg hover:bg-red-600 transition-colors">
                    <i data-lucide="log-out" class="w-6 h-6"></i>
                    <span class="ml-3">Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 p-10 overflow-auto">
            <div id="loader" class="flex justify-center items-center h-full">
                <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-indigo-500"></div>
            </div>

            <div id="main-content" class="hidden">
                <h2 class="text-3xl font-bold mb-4">Staff Dashboard</h2>
                <p class="text-gray-400 mb-8">Welcome. This is your central hub for all staff policies, procedures, and tools.</p>

                <!-- Tab Navigation -->
                <div class="mb-8 border-b border-gray-700">
                    <nav class="flex -mb-px space-x-4" aria-label="Tabs">
                        <button class="tab-btn active" data-tab="policies">Core Policies</button>
                        <button class="tab-btn" data-tab="discipline">Disciplinary Guide</button>
                        <button class="tab-btn" data-tab="roles">Staff Roles & Info</button>
                        <button class="tab-btn" data-tab="responses">Ticket Responses</button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div id="tab-container">
                    <!-- Core Policies Tab -->
                    <div id="policies" class="tab-content active space-y-8">
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-indigo-300">🌟 The Golden Standard</h3>
                            <p>Staff serve the community—not themselves. Your role is to create a better, more enjoyable RP experience for everyone—not to gain power or privileges. Use your role with integrity and lead by example. No special treatment, no shortcuts, and no bending the rules for personal gain.</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4 text-indigo-300">🧠 Common Sense Comes First</h3>
                                <p>We want thoughtful staff who can read a situation and act in the best interest of the community. Policies exist to guide, not to micromanage. Don’t misuse "gray areas" as loopholes. Stay active and tuned into the culture of Nightlife RP.</p>
                            </div>
                            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4 text-indigo-300">⚖️ Handling Bias</h3>
                                <p>Don’t admin when angry or emotionally involved. Never handle tickets where you're personally involved. Always defer to another staff member if you were involved in the incident or conflict. Our team structure exists so you don't have to make every decision alone.</p>
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 text-indigo-300">🔒 Confidentiality & Staff Privacy</h3>
                            <p>What happens in staff channels, stays in staff channels. Do not share details of tickets, admin actions, internal debates, or development plans. Keep replies to players neutral and professional; direct them to open a support ticket for official responses. Never argue or explain staff decisions in public chats.</p>
                        </div>
                    </div>

                    <!-- Disciplinary Guide Tab -->
                    <div id="discipline" class="tab-content">
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4">Community Enforcement Guide</h3>
                            <p class="mb-4">Our top priority is an engaging and inclusive environment. Discipline should be fair and focused on growth. High-impact actions like bans are used only when patterns emerge or for serious violations.</p>
                            <p><strong>Points System:</strong> Every violation earns points. Reaching <strong>30 points</strong> results in an automatic <strong>30-day ban</strong>. Points decay after 30 days from application.</p>
                            <hr class="my-4 border-gray-600">
                            <h4 class="text-lg font-semibold mb-4">Disciplinary Actions Reference</h4>
                            <div class="max-h-[60vh] overflow-y-auto">
                                <table class="w-full text-sm text-left text-gray-400">
                                    <thead class="text-xs text-gray-300 uppercase bg-gray-700 sticky top-0">
                                        <tr>
                                            <th scope="col" class="px-6 py-3">Violation</th>
                                            <th scope="col" class="px-6 py-3">Punishment</th>
                                        </tr>
                                    </thead>
                                    <tbody id="punishments-table">
                                        <!-- JS will populate this -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Staff Roles & Info Tab -->
                    <div id="roles" class="tab-content space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4">Staff Weekly Hour Requirements</h3>
                                <ul class="list-disc list-inside text-gray-300">
                                    <li><strong>Discord Support:</strong> 5 hours</li>
                                    <li><strong>Trial Moderator:</strong> 8 hours</li>
                                    <li><strong>Moderator:</strong> 10 hours</li>
                                    <li><strong>Senior Moderator:</strong> 12 hours</li>
                                    <li><strong>Junior Admin:</strong> 15 hours</li>
                                    <li><strong>Administrator+:</strong> 18 hours</li>
                                    <li><strong>Management+:</strong> 20 hours</li>
                                </ul>
                            </div>
                            <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4">⚠️ Staff Strike System</h3>
                                <ul class="list-disc list-inside text-gray-300">
                                    <li><strong>1st Strike:</strong> Suspension from staff duties for 3 days.</li>
                                    <li><strong>2nd Strike:</strong> Suspension from staff duties for 1 week.</li>
                                    <li><strong>3rd Strike:</strong> Permanent removal from the staff team.</li>
                                    <li class="mt-2"><strong>Major Violations:</strong> Abuse of power, cheating, or severe unprofessionalism can lead to immediate removal without warning.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4">Staff Roles & Hierarchy</h3>
                            <div class="space-y-6 text-gray-300 max-h-[60vh] overflow-y-auto pr-3">
                                <div>
                                    <h4 class="text-lg font-bold text-indigo-400">👑 Executive & Development Team</h4>
                                    <p class="mt-2"><strong>Director:</strong> The founder and highest authority, overseeing all aspects of the community and making final decisions.</p>
                                    <p class="mt-1"><strong>Lead Developer:</strong> Manages all development work, implements new features, and ensures the city runs smoothly.</p>
                                    <p class="mt-1"><strong>Developer:</strong> Assists with technical aspects, bug fixes, and performance optimization.</p>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-indigo-400">🛠️ Management Team</h4>
                                    <p class="mt-2"><strong>Head Management:</strong> Acts as the bridge between executives and staff, overseeing moderation/admin teams and enforcing policy.</p>
                                    <p class="mt-1"><strong>Management:</strong> Supports Head Management and oversees daily staff operations, training, and high-priority player issues.</p>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-indigo-400">🛡️ Administrative Team</h4>
                                    <p class="mt-2"><strong>Senior Admin:</strong> Experienced leaders who handle major rule violations and mentor junior staff.</p>
                                    <p class="mt-1"><strong>Admin:</strong> Enforce server rules, handle player reports, and ensure a fair RP experience.</p>
                                    <p class="mt-1"><strong>Junior Admin:</strong> Staff learning to handle admin responsibilities under supervision.</p>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-indigo-400">👮 Moderation Team</h4>
                                    <p class="mt-2"><strong>Senior Moderator:</strong> Trusted moderators who assist Admins and supervise newer Mods.</p>
                                    <p class="mt-1"><strong>Moderator:</strong> Maintain order in Discord and help with in-game support and tickets.</p>
                                    <p class="mt-1"><strong>Trial Moderator:</strong> Staff in training, learning to support the community under supervision.</p>
                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-indigo-400">💬 Support Team</h4>
                                    <p class="mt-2"><strong>Discord Support:</strong> Assist with community needs, answer common questions, and guide players, but are not moderators or enforcers.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Ticket Responses Tab -->
                    <div id="responses" class="tab-content">
                        <div class="bg-gray-800 rounded-2xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 flex items-center"><i data-lucide="clipboard-list" class="mr-2"></i>Pre-made Ticket Responses</h3>
                            <div id="responses-container" class="space-y-4 max-h-[75vh] overflow-y-auto pr-2">
                                <!-- JS will populate this -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg">
        Copied to clipboard!
    </div>


    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDC3X0D6daim4gKQhBp4S2hoBK8w4EgWRg",
            authDomain: "nightlife-staff.firebaseapp.com",
            projectId: "nightlife-staff",
            storageBucket: "nightlife-staff.appspot.com",
            messagingSenderId: "1092255472588",
            appId: "1:1092255472588:web:a9c2c3e3c6b2b0f2c3d4e5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        const loader = document.getElementById('loader');
        const mainContent = document.getElementById('main-content');
        const logoutBtn = document.getElementById('logout-btn');
        const responsesContainer = document.getElementById('responses-container');
        const punishmentsTable = document.getElementById('punishments-table');
        const toast = document.getElementById('toast');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');

        let presenceInterval = null;

        const punishments = {
            "Underage (18+ City)": "Permanent Ban (Appeal)",
            "Sexual Harassment": "Permanent Ban (Appeal)",
            "Hard R / Homophobic / Transphobic": "Permanent Ban",
            "Staff Impersonation": "Permanent Ban (With Appeal)",
            "AFK To Gain Benefits (e.g., crafting)": "30 day ban",
            "Major Exploiting (e.g., duping)": "30 day - Permanent Ban",
            "Having PD/EMS Equipment (1st)": "300 Comserve + remove items",
            "Having PD/EMS Equipment (2nd)": "400 Comserve + 5 points",
            "Having PD/EMS Equipment (3rd)": "500 Comserve + 5 points",
            "RDM (1st)": "50 Community Service",
            "RDM (2nd)": "75 Comserve + 5 points",
            "RDM (3rd)": "100 Comserve + 5 points",
            "VDM (1st)": "100 Comserve",
            "VDM (2nd)": "150 Comserve + 5 points",
            "VDM (3rd)": "200 Comserve + 5 points",
            "Mass RDM/VDM (1st)": "100 Comserve + 5 points",
            "Mass RDM/VDM (2nd)": "200 Comserve + 10 points",
            "Power Gaming (1st)": "Warning",
            "Power Gaming (2nd)": "30 Comserve + 5 points",
            "Combat Log / F8 Quit (1st)": "50 Comserve + Pocket wipe",
            "Combat Log / F8 Quit (2nd)": "100 Comserve + Pocket wipe + 5 points",
            "New Life Rule / NLR (1st)": "10 Comserve",
            "New Life Rule / NLR (2nd)": "50 Comserve + 5 points",
            "Minor Exploiting (e.g., wall glitch) (1st)": "30 Comserve",
            "Fail RP (1st)": "20 Comserve",
            "Fail RP (2nd)": "50 Comserve + 5 points",
            "Cop Baiting (1st)": "20 Community Service",
            "Cop Baiting (2nd)": "40 Community Service + 5 points",
            "Green Zone Combat (1st)": "50 Community Service",
            "Meta Gaming (1st)": "Warning",
            "Meta Gaming (2nd)": "30 Comserve + 5 points",
            "Scamming (1st)": "30 Comserve + return items",
            "PD/EMS/DOJ Impersonation (1st)": "40 Community Service",
            "Abusing Jobs (1st)": "20 Comserve",
            "Not Valuing Life / NVL (1st)": "30 Community Service",
            "Third Partying (1st)": "50 Community Service + Wipe Inventory if they robbed",
            "Rule of 6 (1st)": "100 Comserve",
            "Police/EMS/DOJ Corruption": "500 Comserve + character wipe",
            "Robbing Pets (1st)": "Warning & Take Item Away"
        };

        const ticketResponses = {
            "Opening Tickets": [
                "Hi there, and thank you for contacting support! 🌟 Could you let us know what you need help with today?",
                "Thank you for reaching out to support. Please describe your issue or request in detail so we can assist you effectively.",
            ],
            "Closing Tickets": [
                "Thank you for reaching out to support. Your ticket has now been resolved, and we’ll go ahead and request to close this. If you have any further issues, please don’t hesitate to open another ticket. Have a great day!",
                "We appreciate you taking the time to contact us. This ticket will now be close requested, but if you need anything else, feel free to submit a new one.",
            ],
            "Rule Breaks & Reports": [
                "Thank you for your report. We take all allegations seriously and will review the evidence provided. While we may not share the exact outcome, rest assured the situation will be handled according to our policies."
            ],
            "Purchases": [
                "Thank you for your purchase and for supporting the server! We’re reviewing your order and will process it shortly. We appreciate your patience. /verify"
            ],
            "Bug / Exploit Reports": [
                "Thank you for bringing this to our attention. Our development team will review your report and work on a fix. We appreciate you helping us improve the city."
            ]
        };

        function populateResponses() {
            for (const category in ticketResponses) {
                const categoryDiv = document.createElement('div');
                categoryDiv.innerHTML = `<h4 class="font-semibold text-indigo-300 mb-2">${category}</h4>`;
                const responsesList = document.createElement('div');
                responsesList.className = 'space-y-3';

                ticketResponses[category].forEach(text => {
                    const responseEl = document.createElement('div');
                    responseEl.className = 'bg-gray-700/50 p-3 rounded-lg text-sm text-gray-300 relative';
                    responseEl.innerHTML = `
                            <p>${text}</p>
                            <button class="copy-btn absolute top-2 right-2 p-1 hover:bg-gray-600 rounded">
                                <i data-lucide="clipboard" class="h-4 w-4 text-gray-400"></i>
                            </button>
                        `;
                    responsesList.appendChild(responseEl);
                });
                categoryDiv.appendChild(responsesList);
                responsesContainer.appendChild(categoryDiv);
            }
        }

        function populatePunishments() {
            for (const violation in punishments) {
                const row = document.createElement('tr');
                row.className = 'bg-gray-800 border-b border-gray-700';
                row.innerHTML = `
                        <td class="px-6 py-4 font-medium text-white whitespace-nowrap">${violation}</td>
                        <td class="px-6 py-4">${punishments[violation]}</td>
                    `;
                punishmentsTable.appendChild(row);
            }
        }

        responsesContainer.addEventListener('click', (e) => {
            const copyBtn = e.target.closest('.copy-btn');
            if (copyBtn) {
                const textToCopy = copyBtn.previousElementSibling.textContent;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    toast.classList.remove('hidden');
                    setTimeout(() => toast.classList.add('hidden'), 2000);
                });
            }
        });

        // --- Tab Logic ---
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                tabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });


        // --- Authentication & Presence ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDocRef = doc(db, "users", user.uid);
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists()) {
                    const currentUser = { uid: user.uid, ...userDocSnap.data() };
                    loader.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                    setupPresence(currentUser);
                } else {
                    window.location.href = 'login.html';
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        // --- Presence System ---
        function setupPresence(user) {
            const presenceDocRef = doc(db, "presence", user.uid);
            setDoc(presenceDocRef, {
                email: user.email,
                status: 'online',
                currentPage: document.title,
                lastSeen: serverTimestamp()
            });
            presenceInterval = setInterval(() => {
                setDoc(presenceDocRef, { lastSeen: serverTimestamp() }, { merge: true });
            }, 60000);
            window.addEventListener('beforeunload', () => {
                clearInterval(presenceInterval);
                setDoc(presenceDocRef, { status: 'offline', lastSeen: serverTimestamp() }, { merge: true });
            });
        }

        // --- Logout ---
        logoutBtn.addEventListener('click', () => {
            signOut(auth);
        });

        // Initial Page Load
        populateResponses();
        populatePunishments();
        lucide.createIcons();
    </script>
</body>
</html>
